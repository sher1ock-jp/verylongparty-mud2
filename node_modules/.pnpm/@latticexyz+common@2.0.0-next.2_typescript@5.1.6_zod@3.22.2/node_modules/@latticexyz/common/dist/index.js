import{privateKeyToAccount as w}from"viem/accounts";function q(e){return{...w(e)}}import{getContract as M}from"viem";import O from"p-retry";import{BaseError as H,NonceTooHighError as k,NonceTooLowError as R}from"viem";import W from"debug";var l=W("mud:common");var x=l.extend("createNonceManager");function b({publicClient:e,address:n,blockTag:r}){let t={current:-1},a=typeof BroadcastChannel<"u"?new BroadcastChannel(`mud:createNonceManager:${e.chain?.id}:${n}`):null;a&&a.addEventListener("message",o=>{let T=JSON.parse(o.data);x("got nonce from broadcast channel",T),t.current=T});function s(){return t.current>=0}function d(){if(!s())throw new Error("call resetNonce before using nextNonce");let o=t.current++;return a?.postMessage(JSON.stringify(t.current)),o}async function u(){let o=await e.getTransactionCount({address:n,blockTag:r});t.current=o,a?.postMessage(JSON.stringify(t.current)),x("reset nonce to",t.current)}function C(o){return o instanceof H&&o.walk(T=>T instanceof R||T instanceof k)!=null}return{hasNonce:s,nextNonce:d,resetNonce:u,shouldResetNonce:C}}var m=l.extend("createContract");function E(e){let n=e.length&&Array.isArray(e[0]),r=n?e[0]:[],t=(n?e[1]:e[0])??{};return{args:r,options:t}}function Te({abi:e,address:n,publicClient:r,walletClient:t,onWrite:a}){let s=M({abi:e,address:n,publicClient:r,walletClient:t});if(s.write){let d=0,u=b({publicClient:r,address:t.account.address});s.write=new Proxy({},{get(C,o){async function T(c){if(c.gas)return m("gas provided, skipping simulate",o,c),c;m("simulating write",o,c);let{request:p}=await r.simulateContract({...c,account:c.account??t.account});return p}async function y(c){let p=await T(c);return await O(async()=>{u.hasNonce()||await u.resetNonce();let i=u.nextNonce();return m("calling write function with nonce",i,p),await t.writeContract({nonce:i,...p})},{retries:3,onFailedAttempt:async i=>{if(u.shouldResetNonce(i)){m("got nonce error, retrying",i),await u.resetNonce();return}throw i}})}return(...c)=>{let p=`${t.chain.id}:${t.account.address}:${d++}`,{args:i,options:N}=E(c),g={address:n,abi:e,functionName:o,args:i,...N},f=y(g);return a?.({id:p,request:g,result:f}),f}}})}return s}import{hexToString as A,sliceHex as h}from"viem";function me(e){let n=A(h(e,0,16)).replace(/\0+$/,""),r=A(h(e,16,32)).replace(/\0+$/,"");return{namespace:n,name:r}}import{stringToHex as P,concatHex as G}from"viem";function xe(e,n){return G([P(e.substring(0,16),{size:16}),P(n.substring(0,16),{size:16})])}import{keccak256 as $}from"viem";var B=l.extend("transportObserver");function Ne(e){return n=>{let r=e(n);return{...r,request:async a=>{if(a.method==="eth_sendRawTransaction"&&a.params instanceof Array){let s=a.params.map(d=>$(d));B("saw txs",s)}return r.request(a)}}}}export{q as createBurnerAccount,Te as createContract,b as createNonceManager,me as hexToTableId,xe as tableIdToHex,Ne as transportObserver};
//# sourceMappingURL=index.js.map
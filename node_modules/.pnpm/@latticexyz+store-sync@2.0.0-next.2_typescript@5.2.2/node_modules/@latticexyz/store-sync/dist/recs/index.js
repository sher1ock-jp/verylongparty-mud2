import{a as T,b as B}from"../chunk-NYP36QN7.js";import{a as l}from"../chunk-FDO75HXB.js";import"../chunk-A2BQSIM3.js";import{decodeAbiParameters as v}from"viem";import{sliceHex as P,size as j,isHex as M}from"viem";function d(e){if(!M(e))throw new Error(`entity ${e} is not a hex string`);let i=j(e);if(i%32!==0)throw new Error(`entity length ${i} is not a multiple of 32 bytes`);return new Array(i/32).fill(0).map((r,n)=>P(e,n*32,(n+1)*32))}function rt(e,i){let r=d(i);if(r.length!==Object.keys(e).length)throw new Error(`entity key tuple length ${r.length} does not match key schema length ${Object.keys(e).length}`);return Object.fromEntries(Object.entries(e).map(([n,a],o)=>[n,v([{type:a}],r[o])[0]]))}import{encodeAbiParameters as V}from"viem";import{concatHex as w}from"viem";function p(e){return w(e)}function C(e,i){if(Object.keys(e).length!==Object.keys(i).length)throw new Error(`key length ${Object.keys(i).length} does not match key schema length ${Object.keys(e).length}`);return p(Object.entries(e).map(([r,n])=>V([{type:n}],[i[r]])))}function pt(e){return e.metadata?.componentName!=null&&e.metadata?.tableName!=null&&e.metadata?.keySchema!=null&&e.metadata?.valueSchema!=null}var g=l.extend("recs");import{getComponentValue as h,removeComponent as D,setComponent as x,updateComponent as L}from"@latticexyz/recs";import{isDefined as z}from"@latticexyz/common/utils";import{getAddress as W}from"viem";function c(e){return`${W(e.address)}:${e.namespace}:${e.name}`}import{tableIdToHex as F}from"@latticexyz/common";function R({components:e}){let i=Object.fromEntries(Object.entries(e).map(([r,n])=>[n.id,n]));return{async registerTables({tables:r}){for(let n of r)x(e.TableMetadata,c(n),{table:n})},async getTables({tables:r}){return r.map(n=>h(e.TableMetadata,c(n))?.table).filter(z)},async storeOperations({operations:r}){for(let n of r){let a=h(e.TableMetadata,c({address:n.address,namespace:n.namespace,name:n.name}))?.table;if(!a){g(`skipping update for unknown table: ${n.namespace}:${n.name} at ${n.address}`);continue}let o=F(n.namespace,n.name),m=i[o];if(!m){g(`skipping update for unknown component: ${o}. Available components: ${Object.keys(e)}`);continue}let s=C(a.keySchema,n.key);n.type==="SetRecord"?(g("setting component",o,s,n.value),x(m,s,n.value)):n.type==="SetField"?(g("updating component",o,s,{[n.fieldName]:n.fieldValue}),L(m,s,{[n.fieldName]:n.fieldValue},T(a.valueSchema))):n.type==="DeleteRecord"&&(g("deleting component",o,s),D(m,s))}}}}var S=p([]);import{setComponent as q}from"@latticexyz/recs";import{defineComponent as N,Type as y}from"@latticexyz/recs";function E(e){return{TableMetadata:N(e,{table:y.T},{metadata:{componentName:"TableMetadata"}}),SyncProgress:N(e,{step:y.String,message:y.String,percentage:y.Number,latestBlockNumber:y.BigInt,lastBlockNumberProcessed:y.BigInt},{metadata:{componentName:"SyncProgress"}})}}import G from"@latticexyz/store/mud.config";import J from"@latticexyz/world/mud.config";import{tableIdToHex as U}from"@latticexyz/common";import{defineComponent as Z}from"@latticexyz/recs";import{Type as t}from"@latticexyz/recs";var O={uint8:t.Number,uint16:t.Number,uint24:t.Number,uint32:t.Number,uint40:t.Number,uint48:t.Number,uint56:t.BigInt,uint64:t.BigInt,uint72:t.BigInt,uint80:t.BigInt,uint88:t.BigInt,uint96:t.BigInt,uint104:t.BigInt,uint112:t.BigInt,uint120:t.BigInt,uint128:t.BigInt,uint136:t.BigInt,uint144:t.BigInt,uint152:t.BigInt,uint160:t.BigInt,uint168:t.BigInt,uint176:t.BigInt,uint184:t.BigInt,uint192:t.BigInt,uint200:t.BigInt,uint208:t.BigInt,uint216:t.BigInt,uint224:t.BigInt,uint232:t.BigInt,uint240:t.BigInt,uint248:t.BigInt,uint256:t.BigInt,int8:t.Number,int16:t.Number,int24:t.Number,int32:t.Number,int40:t.Number,int48:t.Number,int56:t.BigInt,int64:t.BigInt,int72:t.BigInt,int80:t.BigInt,int88:t.BigInt,int96:t.BigInt,int104:t.BigInt,int112:t.BigInt,int120:t.BigInt,int128:t.BigInt,int136:t.BigInt,int144:t.BigInt,int152:t.BigInt,int160:t.BigInt,int168:t.BigInt,int176:t.BigInt,int184:t.BigInt,int192:t.BigInt,int200:t.BigInt,int208:t.BigInt,int216:t.BigInt,int224:t.BigInt,int232:t.BigInt,int240:t.BigInt,int248:t.BigInt,int256:t.BigInt,bytes1:t.String,bytes2:t.String,bytes3:t.String,bytes4:t.String,bytes5:t.String,bytes6:t.String,bytes7:t.String,bytes8:t.String,bytes9:t.String,bytes10:t.String,bytes11:t.String,bytes12:t.String,bytes13:t.String,bytes14:t.String,bytes15:t.String,bytes16:t.String,bytes17:t.String,bytes18:t.String,bytes19:t.String,bytes20:t.String,bytes21:t.String,bytes22:t.String,bytes23:t.String,bytes24:t.String,bytes25:t.String,bytes26:t.String,bytes27:t.String,bytes28:t.String,bytes29:t.String,bytes30:t.String,bytes31:t.String,bytes32:t.String,bool:t.Boolean,address:t.String,"uint8[]":t.NumberArray,"uint16[]":t.NumberArray,"uint24[]":t.NumberArray,"uint32[]":t.NumberArray,"uint40[]":t.NumberArray,"uint48[]":t.NumberArray,"uint56[]":t.BigIntArray,"uint64[]":t.BigIntArray,"uint72[]":t.BigIntArray,"uint80[]":t.BigIntArray,"uint88[]":t.BigIntArray,"uint96[]":t.BigIntArray,"uint104[]":t.BigIntArray,"uint112[]":t.BigIntArray,"uint120[]":t.BigIntArray,"uint128[]":t.BigIntArray,"uint136[]":t.BigIntArray,"uint144[]":t.BigIntArray,"uint152[]":t.BigIntArray,"uint160[]":t.BigIntArray,"uint168[]":t.BigIntArray,"uint176[]":t.BigIntArray,"uint184[]":t.BigIntArray,"uint192[]":t.BigIntArray,"uint200[]":t.BigIntArray,"uint208[]":t.BigIntArray,"uint216[]":t.BigIntArray,"uint224[]":t.BigIntArray,"uint232[]":t.BigIntArray,"uint240[]":t.BigIntArray,"uint248[]":t.BigIntArray,"uint256[]":t.BigIntArray,"int8[]":t.NumberArray,"int16[]":t.NumberArray,"int24[]":t.NumberArray,"int32[]":t.NumberArray,"int40[]":t.NumberArray,"int48[]":t.NumberArray,"int56[]":t.BigIntArray,"int64[]":t.BigIntArray,"int72[]":t.BigIntArray,"int80[]":t.BigIntArray,"int88[]":t.BigIntArray,"int96[]":t.BigIntArray,"int104[]":t.BigIntArray,"int112[]":t.BigIntArray,"int120[]":t.BigIntArray,"int128[]":t.BigIntArray,"int136[]":t.BigIntArray,"int144[]":t.BigIntArray,"int152[]":t.BigIntArray,"int160[]":t.BigIntArray,"int168[]":t.BigIntArray,"int176[]":t.BigIntArray,"int184[]":t.BigIntArray,"int192[]":t.BigIntArray,"int200[]":t.BigIntArray,"int208[]":t.BigIntArray,"int216[]":t.BigIntArray,"int224[]":t.BigIntArray,"int232[]":t.BigIntArray,"int240[]":t.BigIntArray,"int248[]":t.BigIntArray,"int256[]":t.BigIntArray,"bytes1[]":t.StringArray,"bytes2[]":t.StringArray,"bytes3[]":t.StringArray,"bytes4[]":t.StringArray,"bytes5[]":t.StringArray,"bytes6[]":t.StringArray,"bytes7[]":t.StringArray,"bytes8[]":t.StringArray,"bytes9[]":t.StringArray,"bytes10[]":t.StringArray,"bytes11[]":t.StringArray,"bytes12[]":t.StringArray,"bytes13[]":t.StringArray,"bytes14[]":t.StringArray,"bytes15[]":t.StringArray,"bytes16[]":t.StringArray,"bytes17[]":t.StringArray,"bytes18[]":t.StringArray,"bytes19[]":t.StringArray,"bytes20[]":t.StringArray,"bytes21[]":t.StringArray,"bytes22[]":t.StringArray,"bytes23[]":t.StringArray,"bytes24[]":t.StringArray,"bytes25[]":t.StringArray,"bytes26[]":t.StringArray,"bytes27[]":t.StringArray,"bytes28[]":t.StringArray,"bytes29[]":t.StringArray,"bytes30[]":t.StringArray,"bytes31[]":t.StringArray,"bytes32[]":t.StringArray,"bool[]":t.T,"address[]":t.StringArray,bytes:t.String,string:t.String};function u(e,i){return Object.fromEntries(Object.entries(i.tables).map(([r,n])=>[r,Z(e,Object.fromEntries(Object.entries(n.schema).map(([a,o])=>[a,O[o]])),{id:U(i.namespace,r),metadata:{componentName:r,tableName:`${i.namespace}:${r}`,keySchema:n.keySchema,valueSchema:n.schema}})]))}import{assertExhaustive as _}from"@latticexyz/common/utils";function k(e){switch(e){case"initialize":return"Connecting";case"snapshot":return"Hydrating from snapshot";case"rpc":return"Hydrating from RPC";case"live":return"All caught up!";default:_(e,`Unexpected sync step: ${e}`)}}async function oe({world:e,config:i,address:r,publicClient:n,startBlock:a,maxBlockRange:o,initialState:m,indexerUrl:s}){let b={...u(e,i),...u(e,G),...u(e,J),...E(e)};e.registerEntity({id:S});let A=await B({storageAdapter:R({components:b,config:i}),config:i,address:r,publicClient:n,startBlock:a,maxBlockRange:o,indexerUrl:s,initialState:m,onProgress:({step:f,percentage:I,latestBlockNumber:H,lastBlockNumberProcessed:K})=>{console.log("got progress",f,I),q(b.SyncProgress,S,{step:f,percentage:I,latestBlockNumber:H,lastBlockNumberProcessed:K,message:k(f)})}}),$=A.blockStorageOperations$.subscribe();return e.registerDisposer(()=>$.unsubscribe()),{...A,components:b}}export{rt as decodeEntity,C as encodeEntity,d as entityToHexKeyTuple,p as hexKeyTupleToEntity,pt as isStoreComponent,R as recsStorage,S as singletonEntity,oe as syncToRecs};
//# sourceMappingURL=index.js.map